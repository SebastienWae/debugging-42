"use strict";(self.webpackChunk_42_debuggers=self.webpackChunk_42_debuggers||[]).push([[727],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>u});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=d(n),u=i,h=p["".concat(s,".").concat(u)]||p[u]||m[u]||r;return n?a.createElement(h,o(o({ref:t},c),{},{components:n})):a.createElement(h,o({ref:t},c))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var d=2;d<r;d++)o[d]=n[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},3820:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var a=n(7462),i=(n(7294),n(3905));const r={sidebar_position:1},o="Sanitizers",l={unversionedId:"dynamic-analyzers/sanitizers",id:"dynamic-analyzers/sanitizers",title:"Sanitizers",description:"Besides UndefinedBehaviorSanitizer, multiple sanitizers cannot be used at the same time.",source:"@site/docs/dynamic-analyzers/sanitizers.md",sourceDirName:"dynamic-analyzers",slug:"/dynamic-analyzers/sanitizers",permalink:"/debugging-42/dynamic-analyzers/sanitizers",draft:!1,editUrl:"https://github.com/SebastienWae/debugging-42/tree/main/docs/dynamic-analyzers/sanitizers.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"defaultSidebar",previous:{title:"Dynamic Analyzers",permalink:"/debugging-42/category/dynamic-analyzers"},next:{title:"Valgrind",permalink:"/debugging-42/dynamic-analyzers/valgrind"}},s={},d=[{value:"AddressSanitizer",id:"addresssanitizer",level:2},{value:"Example",id:"example",level:3},{value:"LeakSanitizer",id:"leaksanitizer",level:2},{value:"Example",id:"example-1",level:3},{value:"UndefinedBehaviorSanitizer",id:"undefinedbehaviorsanitizer",level:2},{value:"Example",id:"example-2",level:3},{value:"ThreadSanitizer",id:"threadsanitizer",level:2},{value:"Example",id:"example-3",level:3},{value:"Resources",id:"resources",level:2}],c=(m="Godbolt",function(e){return console.warn("Component "+m+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",e)});var m;const p={toc:d};function u(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"sanitizers"},"Sanitizers"),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Besides UndefinedBehaviorSanitizer, multiple sanitizers cannot be used at the same time."))),(0,i.kt)("p",null,"Sanitizers is a Google project that is part of both Clang and GCC. It encompasses multiple tools that can help you detect and fix hard to find bugs."),(0,i.kt)("p",null,"It works by adding extra instructions at compile time and a runtime library. It will require you to re-compile your project, but ",(0,i.kt)("a",{parentName:"p",href:"https://llvm.org/devmtg/2011-11/Serebryany_FindingRacesMemoryErrors.pdf"},"it can find more bugs")," than tools such as Valgrind and has a lower performance impact on your program."),(0,i.kt)("p",null,"More sanitizers, such as ",(0,i.kt)("a",{parentName:"p",href:"https://clang.llvm.org/docs/MemorySanitizer.html"},"MemorySanitizer"),", are available but not covered here as they are not macOS compatible."),(0,i.kt)("h2",{id:"addresssanitizer"},"AddressSanitizer"),(0,i.kt)("p",null,"AddressSanitizer can detect various memory errors, such as:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Out-of-bounds accesses to heap, stack and global"),(0,i.kt)("li",{parentName:"ul"},"Use-after-free"),(0,i.kt)("li",{parentName:"ul"},"Use-after-scope"),(0,i.kt)("li",{parentName:"ul"},"Double-free, invalid free")),(0,i.kt)("p",null,"You can enable it with the ",(0,i.kt)("inlineCode",{parentName:"p"},"-fsanitize=address")," flag."),(0,i.kt)("p",null,"It is also recommended to add the ",(0,i.kt)("inlineCode",{parentName:"p"},"-fno-omit-frame-pointer")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"-fno-optimize-sibling-calls")," flags to get more detailed stack traces."),(0,i.kt)("h3",{id:"example"},"Example"),(0,i.kt)(c,{url:"https://godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:1,lang:___c,selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:'%23include+%3Cstdio.h%3E%0A%23include+%3Cstdlib.h%3E%0A%23include+%3Cstring.h%3E%0A%0Aint+main(int+argc,+const+char+*argv%5B%5D)+%7B%0A++++char+*s+%3D+malloc(100)%3B%0A++++free(s)%3B%0A++++strcpy(s,+%22Hello+world!!%22)%3B%0A++++printf(%22string+is:+%25s%5Cn%22,+s)%3B%0A++++return+0%3B%0A%7D'),l:'5',n:'0',o:'C+source+%231',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:executor,i:(argsPanelShown:'1',compilationPanelShown:'0',compiler:cg121,compilerOutShown:'0',execArgs:'',execStdin:'',fontScale:14,fontUsePx:'0',j:1,lang:___c,libs:!(),options:'-g+-fsanitize%3Daddress+-fno-omit-frame-pointer+-fno-optimize-sibling-calls',source:1,stdinPanelShown:'1',tree:'1',wrap:'1'),l:'5',n:'0',o:'Executor+x86-64+gcc+12.1+(C,+Editor+%231)',t:'0')),header:(),k:50,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4",mdxType:"Godbolt"}),(0,i.kt)("h2",{id:"leaksanitizer"},"LeakSanitizer"),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"LeakSanitizer does not work with the LLVM shipped by Apple, you will have to ",(0,i.kt)("a",{parentName:"p",href:"/#setup"},"install")," a newer version with Homebrew."))),(0,i.kt)("p",null,"LeakSanitizer will show you memory leaks. It is included in AdressSanitizer and enabled by default on Linux, on macOS you will need to enable it explicitly."),(0,i.kt)("p",null,"You can toggle it by changing the value of ",(0,i.kt)("inlineCode",{parentName:"p"},"detect_leaks")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"0")," to disable it or ",(0,i.kt)("inlineCode",{parentName:"p"},"1")," to enable it , in the ",(0,i.kt)("inlineCode",{parentName:"p"},"ASAN_OPTIONS")," variable of your environment."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"$ export ASAN_OPTIONS=detect_leaks=1\n$ export ASAN_OPTIONS=detect_leaks=0\n")),(0,i.kt)("p",null,"You can also use the ",(0,i.kt)("inlineCode",{parentName:"p"},"-fsanitize=leak")," flag to use it as a standalone."),(0,i.kt)("h3",{id:"example-1"},"Example"),(0,i.kt)(c,{url:"https://godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:1,lang:___c,selection:(endColumn:20,endLineNumber:1,positionColumn:20,positionLineNumber:1,selectionStartColumn:20,selectionStartLineNumber:1,startColumn:20,startLineNumber:1),source:'%23include+%3Cstdlib.h%3E%0A%0Avoid+f(void)+%7B%0A++int*+x+%3D+malloc(10+*+sizeof(int))%3B%0A++x%5B10%5D+%3D+0%3B%0A%7D%0A%0Aint+main(void)+%7B%0A++f()%3B%0A++return+0%3B%0A%7D'),l:'5',n:'0',o:'C+source+%231',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:executor,i:(argsPanelShown:'1',compilationPanelShown:'0',compiler:cg121,compilerOutShown:'0',execArgs:'',execStdin:'',fontScale:14,fontUsePx:'0',j:1,lang:___c,libs:!(),options:'-g+-fsanitize%3Dleak',source:1,stdinPanelShown:'1',tree:'1',wrap:'0'),l:'5',n:'0',o:'Executor+x86-64+gcc+12.1+(C,+Editor+%231)',t:'0')),header:(),k:50,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4",mdxType:"Godbolt"}),(0,i.kt)("h2",{id:"undefinedbehaviorsanitizer"},"UndefinedBehaviorSanitizer"),(0,i.kt)("p",null,"UndefinedBehaviorSanitizer will show you bugs such as:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Array subscript out of bounds"),(0,i.kt)("li",{parentName:"ul"},"Dereferencing misaligned or null pointers"),(0,i.kt)("li",{parentName:"ul"},"Signed integer overflow")),(0,i.kt)("p",null,"You can find the list of all checks in the ",(0,i.kt)("a",{parentName:"p",href:"https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html#available-checks"},"documentation")),(0,i.kt)("p",null,"You can enable it with the ",(0,i.kt)("inlineCode",{parentName:"p"},"-fsanitize=undefined")," flag."),(0,i.kt)("p",null,"It is also the only sanitizer that can be used with other sanitizers. You can do it by separating them with a comma ",(0,i.kt)("inlineCode",{parentName:"p"},"-fsanitize=address,undefined"),"."),(0,i.kt)("h3",{id:"example-2"},"Example"),(0,i.kt)(c,{url:"https://godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:1,lang:___c,selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:'int+main(int+argc,+char+**argv)+%7B%0A++return+0x7fffffff+%2B+argc%3B%0A%7D'),l:'5',n:'0',o:'C+source+%231',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:executor,i:(argsPanelShown:'1',compilationPanelShown:'0',compiler:cg121,compilerOutShown:'0',execArgs:'',execStdin:'',fontScale:14,fontUsePx:'0',j:1,lang:___c,libs:!(),options:'-g+-fsanitize%3Dundefined',source:1,stdinPanelShown:'1',tree:'1',wrap:'1'),l:'5',n:'0',o:'Executor+x86-64+gcc+12.1+(C,+Editor+%231)',t:'0')),header:(),k:50,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4",mdxType:"Godbolt"}),(0,i.kt)("h2",{id:"threadsanitizer"},"ThreadSanitizer"),(0,i.kt)("p",null,"ThreadSanitizer will detect data races in your program."),(0,i.kt)("p",null,"You can enable it with the ",(0,i.kt)("inlineCode",{parentName:"p"},"-fsanitize=thread")," flag."),(0,i.kt)("h3",{id:"example-3"},"Example"),(0,i.kt)(c,{url:"https://godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:1,lang:___c,selection:(endColumn:2,endLineNumber:22,positionColumn:2,positionLineNumber:22,selectionStartColumn:2,selectionStartLineNumber:22,startColumn:2,startLineNumber:22),source:'%23include+%3Cpthread.h%3E%0A%23include+%3Cstdio.h%3E%0A%0Aint+Global%3B%0A%0Avoid+*Thread1(void+*x)+%7B%0A++Global%2B%2B%3B%0A++return+NULL%3B%0A%7D%0A%0Avoid+*Thread2(void+*x)+%7B%0A++Global--%3B%0A++return+NULL%3B%0A%7D%0A%0Aint+main()+%7B%0A++pthread_t+t%5B2%5D%3B%0A++pthread_create(%26t%5B0%5D,+NULL,+Thread1,+NULL)%3B%0A++pthread_create(%26t%5B1%5D,+NULL,+Thread2,+NULL)%3B%0A++pthread_join(t%5B0%5D,+NULL)%3B%0A++pthread_join(t%5B1%5D,+NULL)%3B%0A%7D'),l:'5',n:'0',o:'C+source+%231',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:executor,i:(argsPanelShown:'1',compilationPanelShown:'0',compiler:cclang1400,compilerOutShown:'0',execArgs:'',execStdin:'',fontScale:14,fontUsePx:'0',j:1,lang:___c,libs:!(),options:'-pthread+-fsanitize%3Dthread',source:1,stdinPanelShown:'1',tree:'1',wrap:'1'),l:'5',n:'0',o:'Executor+x86-64+clang+14.0.0+(C,+Editor+%231)',t:'0')),header:(),k:50,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4",mdxType:"Godbolt"}),(0,i.kt)("h2",{id:"resources"},"Resources"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/google/sanitizers/wiki"},"https://github.com/google/sanitizers/wiki")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://developer.apple.com/documentation/xcode/diagnosing-memory-thread-and-crash-issues-early"},"https://developer.apple.com/documentation/xcode/diagnosing-memory-thread-and-crash-issues-early")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://clang.llvm.org/docs/AddressSanitizer.html"},"https://clang.llvm.org/docs/AddressSanitizer.html")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://clang.llvm.org/docs/LeakSanitizer.html"},"https://clang.llvm.org/docs/LeakSanitizer.html")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html"},"https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://clang.llvm.org/docs/ThreadSanitizer.html"},"https://clang.llvm.org/docs/ThreadSanitizer.html"))))}u.isMDXComponent=!0}}]);